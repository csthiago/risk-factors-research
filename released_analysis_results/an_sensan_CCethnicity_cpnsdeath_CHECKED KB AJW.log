-------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_sensan_CCethnicity_cpnsdeath.log
  log type:  text
 opened on:  12 May 2020, 19:40:50

. 
. *an_sensan_CCethnicity_cpnsdeath
. use "cr_create_analysis_dataset_STSET_cpnsdeath.dta", clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. drop if ethnicity>=.
(4,563,711 observations deleted)

. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. *Complete case ethnicity model
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2335.74 /        1 =    2335.7410

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(40)      =    13946.46
Log likelihood  =   -48421.847                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |    1.11556   .0302608     4.03   0.000     1.057799    1.176475
                         age2 |   .9957497    .060408    -0.07   0.944     .8841203    1.121474
                         age3 |   .9667599   .1376475    -0.24   0.812     .7313485    1.277947
                       1.male |   1.920218   .0640094    19.57   0.000     1.798772    2.049863
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.276791   .0507326     6.15   0.000      1.18113    1.380199
          Obese II (35-39.9)  |   1.593618   .0923518     8.04   0.000     1.422513    1.785305
             Obese III (40+)  |   2.258596   .1747845    10.53   0.000     1.940739    2.628511
                              |
                 smoke_nomiss |
                      Former  |   1.313649   .0479167     7.48   0.000     1.223012    1.411002
                     Current  |   .9321873   .0622215    -1.05   0.293     .8178757    1.062476
                              |
                    ethnicity |
                       Mixed  |    1.62095   .2636369     2.97   0.003     1.178494    2.229523
      Asian or Asian British  |   1.600837    .097997     7.69   0.000     1.419841    1.804905
                       Black  |   1.679107   .1450815     6.00   0.000     1.417526    1.988958
                       Other  |   1.322562   .1768235     2.09   0.037     1.017682    1.718777
                              |
                          imd |
                           2  |   1.192402   .0646056     3.25   0.001     1.072269    1.325994
                           3  |   1.255986   .0678101     4.22   0.000     1.129871    1.396178
                           4  |   1.530695   .0807325     8.07   0.000     1.380366    1.697396
             5 most deprived  |    1.68829   .0915027     9.66   0.000     1.518145    1.877504
                              |
           1.htdiag_or_highbp |   .9632672   .0367406    -0.98   0.326     .8938827    1.038038
1.chronic_respiratory_disease |   1.792397   .0701359    14.91   0.000     1.660073     1.93527
                              |
                    asthmacat |
                 Yes, no OCS  |   1.030567   .0488918     0.63   0.526     .9390608    1.130989
                Yes with OCS  |   1.246971   .1021396     2.69   0.007     1.062024    1.464126
                              |
    1.chronic_cardiac_disease |   1.248492   .0435438     6.36   0.000        1.166    1.336821
                              |
                      diabcat |
         Controlled diabetes  |   1.457635    .057459     9.56   0.000     1.349258    1.574717
       Uncontrolled diabetes  |   2.146009   .1040262    15.75   0.000     1.951507    2.359896
  Diabetes, no hba1c measure  |   1.859662   .1503725     7.67   0.000     1.587106    2.179026
                              |
            cancer_exhaem_cat |
                   Last year  |   1.683349   .1863444     4.70   0.000     1.355025    2.091226
               2-5 years ago  |    1.20029   .0919036     2.38   0.017     1.033027    1.394636
                    5+ years  |   1.009395   .0527547     0.18   0.858     .9111169    1.118273
                              |
              cancer_haem_cat |
                   Last year  |   3.097466   .7135329     4.91   0.000     1.972076    4.865075
               2-5 years ago  |   3.364984   .4249581     9.61   0.000     2.627158    4.310025
                    5+ years  |   1.811399   .2132935     5.05   0.000     1.438085    2.281622
                              |
      1.chronic_liver_disease |   1.625206   .1780691     4.43   0.000     1.311127    2.014523
            1.stroke_dementia |   1.741463   .0744969    12.97   0.000     1.601405     1.89377
                1.other_neuro |    2.42382   .1672258    12.83   0.000     2.117258    2.774771
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.598475   .0603401    12.43   0.000      1.48448    1.721225
           Stage 4/5 egfr<30  |   3.430846   .2072074    20.41   0.000     3.047843    3.861979
                              |
           1.organ_transplant |   3.939245   .6286299     8.59   0.000     2.881225    5.385783
                     1.spleen |     1.4251   .3374672     1.50   0.135     .8959395    2.266794
           1.ra_sle_psoriasis |   1.168456   .0634989     2.86   0.004     1.050399    1.299781
    1.other_immunosuppression |   1.822908   .3032897     3.61   0.000     1.315662    2.525718
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCe
> th, replace
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster save
> d
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"

.  
.  
. *Model without ethnicity among ethnicity complete cases 
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(0) if("if ethnicity<.")
   1:   2091.98 /        1 =    2091.9810

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(36)      =    13865.67
Log likelihood  =   -48462.242                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.119022   .0304247     4.14   0.000     1.060951     1.18027
                         age2 |   .9825435   .0597192    -0.29   0.772     .8721989    1.106848
                         age3 |   1.000669   .1427162     0.00   0.996      .756644    1.323395
                       1.male |   1.940298   .0645651    19.92   0.000     1.817791    2.071061
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.259088   .0500001     5.80   0.000     1.164806    1.361001
          Obese II (35-39.9)  |    1.55318   .0899061     7.61   0.000     1.386595    1.739777
             Obese III (40+)  |   2.175763   .1681268    10.06   0.000      1.86998    2.531548
                              |
                 smoke_nomiss |
                      Former  |   1.249427   .0448126     6.21   0.000     1.164612    1.340418
                     Current  |   .8802749   .0584366    -1.92   0.055     .7728795    1.002594
                              |
                          imd |
                           2  |   1.194398   .0647142     3.28   0.001     1.074063    1.328215
                           3  |   1.275554   .0688012     4.51   0.000      1.14759    1.417788
                           4  |   1.582646   .0831742     8.74   0.000     1.427742    1.754356
             5 most deprived  |   1.790166   .0960805    10.85   0.000     1.611418    1.988742
                              |
           1.htdiag_or_highbp |   .9689923    .036943    -0.83   0.409     .8992245    1.044173
1.chronic_respiratory_disease |   1.770888   .0692604    14.61   0.000     1.640213    1.911974
                              |
                    asthmacat |
                 Yes, no OCS  |   1.044198   .0494958     0.91   0.362     .9515581    1.145857
                Yes with OCS  |   1.272705   .1041905     2.95   0.003     1.084036     1.49421
                              |
    1.chronic_cardiac_disease |   1.249929   .0435621     6.40   0.000       1.1674    1.338293
                              |
                      diabcat |
         Controlled diabetes  |   1.517571   .0592921    10.68   0.000     1.405698    1.638346
       Uncontrolled diabetes  |   2.265046   .1086952    17.04   0.000     2.061719    2.488425
  Diabetes, no hba1c measure  |   1.950296   .1572205     8.29   0.000      1.66526    2.284121
                              |
            cancer_exhaem_cat |
                   Last year  |   1.657818   .1834754     4.57   0.000     1.334541    2.059405
               2-5 years ago  |   1.183063    .090549     2.20   0.028      1.01826    1.374538
                    5+ years  |   .9957163   .0519804    -0.08   0.934     .8988753    1.102991
                              |
              cancer_haem_cat |
                   Last year  |    3.12158   .7190183     4.94   0.000     1.987515    4.902735
               2-5 years ago  |   3.354203   .4235801     9.58   0.000     2.618767    4.296175
                    5+ years  |   1.794627   .2113152     4.97   0.000     1.424774    2.260487
                              |
      1.chronic_liver_disease |   1.611667   .1766155     4.36   0.000     1.300157    1.997812
            1.stroke_dementia |   1.743599    .074562    13.00   0.000     1.603417    1.896036
                1.other_neuro |   2.424251   .1671832    12.84   0.000     2.117758    2.775101
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.604341   .0605957    12.52   0.000     1.489865    1.727612
           Stage 4/5 egfr<30  |   3.478447   .2101399    20.63   0.000     3.090029    3.915688
                              |
           1.organ_transplant |   4.044765   .6453684     8.76   0.000     2.958548    5.529782
                     1.spleen |   1.433687   .3394797     1.52   0.128     .9013636    2.280387
           1.ra_sle_psoriasis |   1.156987   .0628456     2.68   0.007     1.040142    1.286958
    1.other_immunosuppression |    1.87879   .3121757     3.80   0.000     1.356577    2.602029
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCn
> oeth, replace
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCnoeth.ster sa
> ved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC MODEL (excluding ethnicity) DID NOT FIT (OUTCOME `outcome')"

.  
. 
.  *Complete case ethnicity model with age group
. basecoxmodel, age("ib3.agegroup") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2221.86 /        1 =    2221.8560

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(42)      =    13572.66
Log likelihood  =   -48608.747                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                     agegroup |
                      18-<40  |   .0793324    .014482   -13.88   0.000     .0554708    .1134582
                      40-<50  |   .2946317   .0384428    -9.37   0.000     .2281481    .3804889
                      60-<70  |    2.08934   .1557527     9.88   0.000     1.805324    2.418037
                      70-<80  |    4.90831   .3414093    22.87   0.000     4.282768    5.625218
                         80+  |   12.11825   .8632062    35.02   0.000     10.53918    13.93389
                              |
                       1.male |   1.833905   .0608179    18.29   0.000     1.718495    1.957065
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.202263   .0475085     4.66   0.000     1.112663    1.299079
          Obese II (35-39.9)  |   1.468304   .0846793     6.66   0.000     1.311372    1.644016
             Obese III (40+)  |   2.042267   .1573557     9.27   0.000     1.756014    2.375184
                              |
                 smoke_nomiss |
                      Former  |   1.317033   .0480924     7.54   0.000     1.226068    1.414747
                     Current  |   .8825799   .0587412    -1.88   0.061     .7746425    1.005557
                              |
                    ethnicity |
                       Mixed  |   1.568307   .2550865     2.77   0.006     1.140203    2.157147
      Asian or Asian British  |   1.549841   .0948906     7.16   0.000     1.374585    1.747442
                       Black  |   1.622095   .1401816     5.60   0.000     1.369353    1.921486
                       Other  |   1.290587   .1725479     1.91   0.056     .9930793    1.677222
                              |
                          imd |
                           2  |   1.192746   .0646246     3.25   0.001     1.072578    1.326378
                           3  |   1.256035   .0678256     4.22   0.000     1.129892     1.39626
                           4  |   1.529665   .0807201     8.05   0.000     1.379363    1.696345
             5 most deprived  |   1.684118   .0912963     9.62   0.000     1.514358    1.872907
                              |
           1.htdiag_or_highbp |   .9985052   .0381921    -0.04   0.969     .9263871    1.076238
1.chronic_respiratory_disease |   1.786789   .0700842    14.80   0.000     1.654574    1.929569
                              |
                    asthmacat |
                 Yes, no OCS  |   1.014917   .0481372     0.31   0.755     .9248223    1.113789
                Yes with OCS  |   1.225144   .1003149     2.48   0.013     1.043496    1.438413
                              |
    1.chronic_cardiac_disease |   1.289559   .0451152     7.27   0.000     1.204099    1.381086
                              |
                      diabcat |
         Controlled diabetes  |    1.44141     .05697     9.25   0.000     1.333967    1.557508
       Uncontrolled diabetes  |   2.068097   .1003995    14.97   0.000      1.88039    2.274542
  Diabetes, no hba1c measure  |   1.911386   .1546274     8.01   0.000     1.631128    2.239799
                              |
            cancer_exhaem_cat |
                   Last year  |   1.675379    .185467     4.66   0.000     1.348602    2.081337
               2-5 years ago  |   1.191371   .0912537     2.29   0.022     1.025295    1.384348
                    5+ years  |   1.024272   .0535768     0.46   0.647      .924467    1.134852
                              |
              cancer_haem_cat |
                   Last year  |   3.046396   .7016746     4.84   0.000     1.939678    4.784572
               2-5 years ago  |   3.278557   .4140944     9.40   0.000     2.559603    4.199453
                    5+ years  |   1.792335   .2110791     4.95   0.000     1.422902    2.257684
                              |
      1.chronic_liver_disease |   1.584829   .1733491     4.21   0.000     1.279021    1.963754
            1.stroke_dementia |   1.815744   .0777055    13.94   0.000     1.669656    1.974613
                1.other_neuro |   2.377381   .1641609    12.54   0.000     2.076455     2.72192
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.764607   .0657306    15.25   0.000     1.640367    1.898255
           Stage 4/5 egfr<30  |   3.984811   .2382484    23.12   0.000     3.544175     4.48023
                              |
           1.organ_transplant |   3.523392    .561734     7.90   0.000     2.577829    4.815795
                     1.spleen |   1.386056    .328207     1.38   0.168     .8714111    2.204644
           1.ra_sle_psoriasis |   1.149442   .0624558     2.56   0.010     1.033324    1.278609
    1.other_immunosuppression |   1.741799   .2896347     3.34   0.001      1.25735    2.412903
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_CCet
> h, replace
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_CCeth.ster saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGEGROUP DID NOT FIT (OUTCOME `outcome')"

.  
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_sensan_CCethnicity_cpnsdeath.log
  log type:  text
 closed on:  12 May 2020, 21:32:19
-------------------------------------------------------------------------------------------------------
