-------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_multivariable_cox_models_cpnsdeath.log
  log type:  text
 opened on:  12 May 2020, 19:40:49

. 
. use "cr_create_analysis_dataset_STSET_`outcome'.dta", clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. 
. *Age spline model (not adj ethnicity)
. basecoxmodel, age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0)
   1:   2860.78 /        1 =    2860.7760

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,832                  Number of obs    =  17,282,832
No. of failures =        5,651
Time at risk    =   1449942098
                                                LR chi2(36)      =    18789.77
Log likelihood  =   -66602.213                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |    1.13192   .0273733     5.12   0.000     1.079521    1.186863
                         age2 |   .9628658   .0519128    -0.70   0.483     .8663101    1.070183
                         age3 |   1.047567    .132372     0.37   0.713     .8177546    1.341964
                       1.male |   1.979978   .0569777    23.74   0.000     1.871394    2.094861
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.264374   .0437958     6.77   0.000     1.181385    1.353193
          Obese II (35-39.9)  |   1.552663   .0789598     8.65   0.000     1.405367    1.715397
             Obese III (40+)  |   2.244601   .1504945    12.06   0.000     1.968196    2.559823
                              |
                 smoke_nomiss |
                      Former  |   1.246701   .0383438     7.17   0.000     1.173768    1.324164
                     Current  |   .8765587   .0507536    -2.28   0.023     .7825203     .981898
                              |
                          imd |
                           2  |   1.133522   .0511419     2.78   0.005      1.03759    1.238324
                           3  |   1.231045   .0552692     4.63   0.000     1.127349     1.34428
                           4  |   1.486356   .0657425     8.96   0.000      1.36293    1.620959
             5 most deprived  |   1.733897   .0785947    12.14   0.000     1.586499     1.89499
                              |
           1.htdiag_or_highbp |    .934567   .0303033    -2.09   0.037     .8770216    .9958882
1.chronic_respiratory_disease |   1.783881   .0606524    17.02   0.000     1.668879    1.906808
                              |
                    asthmacat |
                 Yes, no OCS  |   1.107006   .0450601     2.50   0.013      1.02212     1.19894
                Yes with OCS  |   1.250217   .0918718     3.04   0.002     1.082518    1.443896
                              |
    1.chronic_cardiac_disease |   1.247208   .0374503     7.36   0.000     1.175925    1.322812
                              |
                      diabcat |
         Controlled diabetes  |   1.481593   .0503676    11.56   0.000     1.386091    1.583674
       Uncontrolled diabetes  |   2.265623   .0944799    19.61   0.000     2.087811    2.458578
  Diabetes, no hba1c measure  |   1.822524   .1311296     8.34   0.000     1.582814    2.098537
                              |
            cancer_exhaem_cat |
                   Last year  |   1.557582   .1532932     4.50   0.000     1.284333    1.888965
               2-5 years ago  |   1.180274   .0776401     2.52   0.012     1.037503    1.342691
                    5+ years  |   .9575628   .0434533    -0.96   0.339     .8760734    1.046632
                              |
              cancer_haem_cat |
                   Last year  |   3.344638   .6463274     6.25   0.000     2.290131    4.884698
               2-5 years ago  |   3.058155   .3472812     9.84   0.000     2.447923    3.820508
                    5+ years  |     1.8597   .1865312     6.19   0.000     1.527798    2.263706
                              |
      1.chronic_liver_disease |    1.62586   .1583507     4.99   0.000     1.343322    1.967822
            1.stroke_dementia |   1.784802   .0653043    15.83   0.000      1.66129    1.917497
                1.other_neuro |   2.471448   .1460524    15.31   0.000     2.201147    2.774943
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.554674   .0504024    13.61   0.000      1.45896    1.656667
           Stage 4/5 egfr<30  |   3.488515   .1804599    24.15   0.000     3.152159    3.860762
                              |
           1.organ_transplant |   3.638394   .5353668     8.78   0.000     2.726847    4.854658
                     1.spleen |    1.40708   .2947127     1.63   0.103     .9333292    2.121304
           1.ra_sle_psoriasis |   1.230381   .0566163     4.51   0.000     1.124272    1.346505
    1.other_immunosuppression |   1.815522   .2762957     3.92   0.000      1.34729    2.446481
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmica
> t_noeth, replace
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_noe
> th.ster not found)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster
>  saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING AGE SPLINE MODEL DID NOT FIT (OUTCOME `outcome')"

.  
. *Age group model (not adj ethnicity)
. basecoxmodel, age("ib3.agegroup") bp("i.htdiag_or_highbp") ethnicity(0)
   1:   2883.98 /        1 =    2883.9760

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,832                  Number of obs    =  17,282,832
No. of failures =        5,651
Time at risk    =   1449942098
                                                LR chi2(38)      =    18304.18
Log likelihood  =    -66845.01                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                     agegroup |
                      18-<40  |   .0696364   .0116615   -15.91   0.000     .0501524    .0966898
                      40-<50  |   .3074801   .0357583   -10.14   0.000     .2448086    .3861956
                      60-<70  |   2.117182   .1395116    11.38   0.000     1.860665    2.409062
                      70-<80  |   4.878173   .2992699    25.83   0.000     4.325507    5.501453
                         80+  |   12.73855   .7930256    40.88   0.000     11.27533    14.39165
                              |
                       1.male |   1.886313   .0539836    22.18   0.000      1.78342    1.995143
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.190542   .0409923     5.07   0.000      1.11285    1.273659
          Obese II (35-39.9)  |   1.432484   .0724683     7.10   0.000     1.297263      1.5818
             Obese III (40+)  |   2.036534   .1359188    10.66   0.000     1.786826    2.321138
                              |
                 smoke_nomiss |
                      Former  |   1.252178   .0385631     7.30   0.000     1.178832    1.330088
                     Current  |   .8328239   .0480745    -3.17   0.002     .7437343    .9325853
                              |
                          imd |
                           2  |     1.1352   .0512184     2.81   0.005     1.039125    1.240159
                           3  |   1.233748   .0554032     4.68   0.000     1.129801    1.347258
                           4  |    1.48747   .0658341     8.97   0.000     1.363876    1.622264
             5 most deprived  |    1.72806   .0783765    12.06   0.000     1.581074     1.88871
                              |
           1.htdiag_or_highbp |   .9627748   .0313186    -1.17   0.244     .9033073    1.026157
1.chronic_respiratory_disease |   1.773382    .060424    16.81   0.000     1.658821    1.895855
                              |
                    asthmacat |
                 Yes, no OCS  |    1.08756   .0442541     2.06   0.039     1.004192    1.177849
                Yes with OCS  |     1.2235   .0898799     2.75   0.006     1.059433    1.412975
                              |
    1.chronic_cardiac_disease |   1.282934   .0386382     8.27   0.000     1.209396    1.360943
                              |
                      diabcat |
         Controlled diabetes  |   1.453981   .0495445    10.98   0.000     1.360047    1.554403
       Uncontrolled diabetes  |   2.165819   .0903833    18.52   0.000     1.995723    2.350414
  Diabetes, no hba1c measure  |   1.864006    .134178     8.65   0.000     1.618731    2.146446
                              |
            cancer_exhaem_cat |
                   Last year  |   1.547901    .152342     4.44   0.000     1.276349    1.877229
               2-5 years ago  |   1.168929   .0769216     2.37   0.018     1.027483    1.329847
                    5+ years  |   .9715396   .0441198    -0.64   0.525      .888803    1.061978
                              |
              cancer_haem_cat |
                   Last year  |   3.266849   .6312622     6.13   0.000     2.236913    4.770997
               2-5 years ago  |   2.954816   .3355819     9.54   0.000     2.365149    3.691496
                    5+ years  |   1.835356   .1841104     6.05   0.000     1.507765    2.234123
                              |
      1.chronic_liver_disease |   1.584616    .154081     4.73   0.000     1.309656    1.917305
            1.stroke_dementia |   1.859316   .0680412    16.95   0.000     1.730628    1.997574
                1.other_neuro |   2.416315   .1428983    14.92   0.000     2.151862    2.713268
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.709407    .054708    16.75   0.000     1.605475    1.820067
           Stage 4/5 egfr<30  |   4.049341   .2072473    27.33   0.000     3.662853     4.47661
                              |
           1.organ_transplant |   3.267146   .4803037     8.05   0.000     2.449251    4.358167
                     1.spleen |   1.374828   .2879277     1.52   0.129     .9119747    2.072593
           1.ra_sle_psoriasis |   1.211634   .0557455     4.17   0.000     1.107156    1.325971
    1.other_immunosuppression |   1.734552   .2638268     3.62   0.000     1.287416    2.336984
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agegroup_bmicat
> _noeth, replace
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_noet
> h.ster not found)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster 
> saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"

. 
. *Complete case ethnicity model
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2287.85 /        1 =    2287.8540

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(40)      =    13946.46
Log likelihood  =   -48421.847                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |    1.11556   .0302608     4.03   0.000     1.057799    1.176475
                         age2 |   .9957497    .060408    -0.07   0.944     .8841203    1.121474
                         age3 |   .9667599   .1376475    -0.24   0.812     .7313485    1.277947
                       1.male |   1.920218   .0640094    19.57   0.000     1.798772    2.049863
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.276791   .0507326     6.15   0.000      1.18113    1.380199
          Obese II (35-39.9)  |   1.593618   .0923518     8.04   0.000     1.422513    1.785305
             Obese III (40+)  |   2.258596   .1747845    10.53   0.000     1.940739    2.628511
                              |
                 smoke_nomiss |
                      Former  |   1.313649   .0479167     7.48   0.000     1.223012    1.411002
                     Current  |   .9321873   .0622215    -1.05   0.293     .8178757    1.062476
                              |
                    ethnicity |
                       Mixed  |    1.62095   .2636369     2.97   0.003     1.178494    2.229523
      Asian or Asian British  |   1.600837    .097997     7.69   0.000     1.419841    1.804905
                       Black  |   1.679107   .1450815     6.00   0.000     1.417526    1.988958
                       Other  |   1.322562   .1768235     2.09   0.037     1.017682    1.718777
                              |
                          imd |
                           2  |   1.192402   .0646056     3.25   0.001     1.072269    1.325994
                           3  |   1.255986   .0678101     4.22   0.000     1.129871    1.396178
                           4  |   1.530695   .0807325     8.07   0.000     1.380366    1.697396
             5 most deprived  |    1.68829   .0915027     9.66   0.000     1.518145    1.877504
                              |
           1.htdiag_or_highbp |   .9632672   .0367406    -0.98   0.326     .8938827    1.038038
1.chronic_respiratory_disease |   1.792397   .0701359    14.91   0.000     1.660073     1.93527
                              |
                    asthmacat |
                 Yes, no OCS  |   1.030567   .0488918     0.63   0.526     .9390608    1.130989
                Yes with OCS  |   1.246971   .1021396     2.69   0.007     1.062024    1.464126
                              |
    1.chronic_cardiac_disease |   1.248492   .0435438     6.36   0.000        1.166    1.336821
                              |
                      diabcat |
         Controlled diabetes  |   1.457635    .057459     9.56   0.000     1.349258    1.574717
       Uncontrolled diabetes  |   2.146009   .1040262    15.75   0.000     1.951507    2.359896
  Diabetes, no hba1c measure  |   1.859662   .1503725     7.67   0.000     1.587106    2.179026
                              |
            cancer_exhaem_cat |
                   Last year  |   1.683349   .1863444     4.70   0.000     1.355025    2.091226
               2-5 years ago  |    1.20029   .0919036     2.38   0.017     1.033027    1.394636
                    5+ years  |   1.009395   .0527547     0.18   0.858     .9111169    1.118273
                              |
              cancer_haem_cat |
                   Last year  |   3.097466   .7135329     4.91   0.000     1.972076    4.865075
               2-5 years ago  |   3.364984   .4249581     9.61   0.000     2.627158    4.310025
                    5+ years  |   1.811399   .2132935     5.05   0.000     1.438085    2.281622
                              |
      1.chronic_liver_disease |   1.625206   .1780691     4.43   0.000     1.311127    2.014523
            1.stroke_dementia |   1.741463   .0744969    12.97   0.000     1.601405     1.89377
                1.other_neuro |    2.42382   .1672258    12.83   0.000     2.117258    2.774771
                              |
  reduced_kidney_function_cat |
    Stage 3a/3b egfr 30-60    |   1.598475   .0603401    12.43   0.000      1.48448    1.721225
           Stage 4/5 egfr<30  |   3.430846   .2072074    20.41   0.000     3.047843    3.861979
                              |
           1.organ_transplant |   3.939245   .6286299     8.59   0.000     2.881225    5.385783
                     1.spleen |     1.4251   .3374672     1.50   0.135     .8959395    2.266794
           1.ra_sle_psoriasis |   1.168456   .0634989     2.86   0.004     1.050399    1.299781
    1.other_immunosuppression |   1.822908   .3032897     3.61   0.000     1.315662    2.525718
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmica
> t_CCeth, replace
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCe
> th.ster not found)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster
>  saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"

.  
. 
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_multivariable_cox_models_cpnsdeath.log
  log type:  text
 closed on:  12 May 2020, 21:55:18
-------------------------------------------------------------------------------------------------------
